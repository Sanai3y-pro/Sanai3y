@model sanaiy.UI.ViewModels.CraftsmanProfileViewModel
@{
    Layout = "_CraftsmanLayout";
    ViewData["Title"] = "Craftsman Profile";
    var categories = new SelectList(Model.Categories, "Id", "Name");
}
@using sanaiy.UI.Helpers

<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sanaiy - Craftsman Profile</title>

    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>

    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#0D47A1",
                        "background-light": "#F7F9FC",
                        "background-dark": "#121212",
                        prima: {
                            50: '#E3F2FD',
                            100: '#BBDEFB',
                            500: '#2196F3',
                            600: '#1E88E5',
                            700: '#0D47A1',
                        },
                    },
                    fontFamily: {
                        display: ["Roboto", "sans-serif"],
                    }
                },
            },
        };
    </script>

    <style>
        .material-icons {
            font-size: inherit;
            line-height: inherit;
        }

        .rating {
            display: flex;
            gap: 2px;
            align-items: center;
        }

        .star {
            font-size: 20px;
        }

            .star.filled {
                color: #FFA500;
            }

            .star.empty {
                color: #D1D5DB;
            }

        .profile-pic-container {
            position: relative;
            display: inline-block;
            border-radius: 50%;
            box-shadow: 0 10px 25px rgba(13, 71, 161, 0.2);
            transition: all 0.3s ease;
        }

            .profile-pic-container:hover {
                transform: translateY(-5px);
                box-shadow: 0 15px 30px rgba(13, 71, 161, 0.3);
            }

            .profile-pic-container img {
                border: 5px solid white;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            }

        .tab-active {
            background-color: #0D47A1;
            color: white;
        }

        .tab-inactive {
            background-color: transparent;
            color: #6B7280;
        }

        .dark .tab-inactive {
            color: #9CA3AF;
        }

        .tab-button {
            position: relative;
            transition: color 0.3s ease, background-color 0.3s ease;
        }

        .tab-content {
            animation: fadeSlideIn 0.4s ease-out;
        }

        @@keyframes fadeSlideIn {
            from {
                opacity: 0;
                transform: translateX(10px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .service-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

            .service-card:hover {
                transform: translateX(-2px);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-gray-800 dark:text-gray-200">

    <main class="flex-grow mt-20">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="w-[85%] mx-auto">

                <!-- Profile Header -->
                <div class="bg-gradient-to-r from-prima-700 to-prima-600 rounded-2xl shadow-soft overflow-hidden mb-8 animate-fade-in">
                    <div class="p-8 text-white">
                        <div class="flex flex-col md:flex-row items-center md:items-start space-y-6 md:space-y-0 md:space-x-8">
                            <div class="profile-pic-container">
                                <img src="@(string.IsNullOrEmpty(Model.ProfileImageUrl) ? "/images/craftsman-default.png" : (Model.ProfileImageUrl.StartsWith("/") ? Model.ProfileImageUrl : "/" + Model.ProfileImageUrl))"
                                     alt="Craftsman Profile Picture"
                                     class="w-32 h-32 object-cover rounded-full">
                            </div>
                            <div class="text-center md:text-left flex-1">
                                <div class="flex flex-col md:flex-row md:items-center justify-between">
                                    <div>
                                        <h1 class="text-4xl font-bold mb-2">@Model.FullName</h1>
                                        <div class="flex items-center flex-wrap gap-2 mb-3">
                                            @if (!string.IsNullOrEmpty(Model.ProfessionalTitle))
                                            {
                                                <span class="inline-flex items-center gap-1 bg-white/20 backdrop-blur-sm px-3 py-1 rounded-full text-sm">
                                                    <i class="material-icons text-sm">work</i>
                                                    <span>@Model.ProfessionalTitle</span>
                                                </span>
                                            }
                                            <span class="inline-flex items-center gap-1 bg-white/20 backdrop-blur-sm px-3 py-1 rounded-full text-sm">
                                                <i class="material-icons text-sm">location_on</i>
                                                <span>@Model.LocationLabel</span>
                                            </span>
                                        </div>
                                        <div class="flex items-center">
                                            <span class="text-lg">★</span>
                                            <span class="text-white/80">@Model.RatingLabel</span>
                                        </div>
                                    </div>
                                    <div class="mt-4 md:mt-0">
                                        <a asp-action="EditProfile" class="px-6 py-3 bg-white text-prima-700 rounded-xl font-semibold hover:bg-gray-100 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1 inline-block">
                                            Edit Profile <i class="material-icons ml-2 align-middle">edit</i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile Details -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Left Column: About & Tabs -->
                    <div class="lg:col-span-2 space-y-8">
                        <!-- About Section -->
                        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-md border border-slate-200 dark:border-slate-700 p-6">
                            <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">About</h2>
                            <p class="text-gray-700 dark:text-gray-300">
                                @(string.IsNullOrWhiteSpace(Model.Bio) ? "No bio added yet." : Model.Bio)
                            </p>
                        </div>

                        <!-- Navigation Tabs -->
                        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-md border border-slate-200 dark:border-slate-700">
                            <div class="flex border-b border-gray-200 dark:border-gray-600">
                                <button class="tab-button flex-1 py-3 px-4 text-center font-medium tab-active" id="tab-services-offered">Services Offered</button>
                                <button class="tab-button flex-1 py-3 px-4 text-center font-medium tab-inactive" id="tab-services-requested">Booked Services</button>
                                <button class="tab-button flex-1 py-3 px-4 text-center font-medium tab-inactive" id="tab-reviews">Reviews</button>
                            </div>
                            <div class="p-6">
                                <!-- Services Offered Tab Content -->
                                <div id="content-services-offered" class="tab-content">
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Services Offered</h3>
                                    <div id="services-list" class="space-y-3">
                                        @if (Model.ServicesOffered == null || !Model.ServicesOffered.Any())
                                        {
                                            <p class="text-sm text-gray-500">You have no services yet.</p>
                                        }
                                        else
                                        {
                                            foreach (var s in Model.ServicesOffered)
                                            {
                                                <div class="service-card flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                                    <div>
                                                        <p class="font-semibold text-gray-800 dark:text-gray-100">@s.Name</p>
                                                        @if (!string.IsNullOrWhiteSpace(s.ShortDescription))
                                                        {
                                                            <p class="text-sm text-gray-500 dark:text-gray-400">@s.ShortDescription</p>
                                                        }
                                                        @if (!string.IsNullOrWhiteSpace(s.Category))
                                                        {
                                                            <span class="inline-block bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded-full dark:bg-blue-900 dark:text-blue-300 mt-1">@s.Category</span>
                                                        }
                                                    </div>
                                                    <div class="flex items-center gap-3">
                                                        @{
                                                            var statusClass = s.Status?.ToLower() switch
                                                            {
                                                                "active" or "approved" => "bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",
                                                                "inactive" => "bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300",
                                                                //"pending" => "bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",
                                                                _ => "bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300"
                                                            };
                                                        }
                                                        <span class="@statusClass text-xs font-semibold px-2.5 py-0.5 rounded-full">@(s.Status ?? "Active")</span>
                                                        <button onclick="deleteService('@s.ServiceId')" class="text-red-600 hover:text-red-800 transition-colors">
                                                            <i class="material-icons">delete</i>
                                                        </button>
                                                    </div>
                                                </div>
                                            }
                                        }
                                    </div>
                                </div>

                                <!-- Services Requested Tab Content -->
                                <div id="content-services-requested" class="tab-content hidden">
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Booked Services</h3>
                                    <div class="space-y-3">
                                        @if (Model.BookedServices == null || !Model.BookedServices.Any())
                                        {
                                            <p class="text-sm text-gray-500">You don't have any bookings yet.</p>
                                        }
                                        else
                                        {
                                            @foreach (var booking in Model.BookedServices)
                                            {
                                                <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                                    <div>
                                                        <div class="flex items-center gap-3 mb-2">
  
                                                             <div class="w-10 h-10 flex items-center justify-center bg-gray-300 text-white rounded-full">
                                                                @booking.ClientName.Substring(0, 1)
                                                            </div> 
                                                            <p class="font-semibold text-gray-800 dark:text-gray-100">@booking.ClientName</p>
                                                            <span class="@booking.StatusBadgeCss text-xs font-semibold px-2.5 py-0.5 rounded-full">
                                                                @booking.StatusText
                                                            </span>
                                                        </div>
                                                        <p class="font-semibold text-gray-800 dark:text-gray-100">@booking.ServiceName</p>
                                                       @*  @if (!string.IsNullOrEmpty(booking.ShortDescription))
                                                        {
                                                            <p class="text-sm text-gray-500 dark:text-gray-400">@booking.ShortDescription</p>
                                                        } *@
                                                        <span class="inline-block bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded-full dark:bg-blue-900 dark:text-blue-300 mt-1">
                                                            @booking.Category
                                                        </span>
                                                    </div>
                                                    <button onclick="openRequestDetailsModal('@booking.Id')"
                                                            class="details-btn px-4 py-2 bg-primary text-white rounded-lg font-medium hover:bg-blue-800 transition-colors">
                                                        Details
                                                    </button>
                                                </div>
                                            }
                                        }
                                    </div>
                                </div>

                                <!-- Reviews Tab Content -->
                                <div id="content-reviews" class="tab-content hidden">
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Recent Reviews</h3>
                                    <div class="space-y-4">
                                        @if (Model.Reviews == null || !Model.Reviews.Any())
                                        {
                                            <p class="text-sm text-gray-500">No reviews yet.</p>
                                        }
                                        else
                                        {
                                            foreach (var review in Model.Reviews)
                                            {
                                                <div class="border-b border-gray-200 dark:border-gray-600 pb-4">
                                                    <div class="flex items-center justify-between mb-2">
                                                        <p class="font-semibold text-gray-800 dark:text-gray-100">@(review.ClientName ?? "Review")</p>
                                                        <div class="rating">
                                                            @for (int i = 0; i < review.Rating; i++)
                                                            {
                                                                <span class="star filled">★</span>
                                                            }
                                                            @for (int i = 0; i < 5 - review.Rating; i++)
                                                            {
                                                                <span class="star empty">★</span>
                                                            }
                                                        </div>
                                                    </div>
                                                    <p class="text-gray-700 dark:text-gray-300">@review.Comment</p>
                                                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">@review.CreatedAt.ToString("MMMM dd, yyyy")</p>
                                                </div>
                                            }
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Contact & Availability -->
                    <div class="space-y-8">
                        <!-- Contact Information -->
                        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-md border border-slate-200 dark:border-slate-700 p-6">
                            <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Contact Information</h2>
                            <div class="space-y-3">
                                <div class="flex items-center">
                                    <i class="material-icons text-primary mr-3">phone</i>
                                    <span class="text-gray-700 dark:text-gray-300">@Model.Phone</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="material-icons text-primary mr-3">email</i>
                                    <span class="text-gray-700 dark:text-gray-300">@Model.Email</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="material-icons text-primary mr-3">location_on</i>
                                    <span class="text-gray-700 dark:text-gray-300">@Model.LocationLabel</span>
                                </div>
                            </div>
                        </div>

                        <!-- Availability -->
                        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-md border border-slate-200 dark:border-slate-700 p-6">
                            <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Availability</h2>
                            @if (Model.Availability != null && Model.Availability.Any())
                            {
                                <div class="space-y-2">
                                    @foreach (var slot in Model.Availability.OrderBy(a => a.Day))
                                    {
                                        <div class="flex justify-between">
                                            <span class="text-gray-700 dark:text-gray-300">@slot.Day</span>
                                            <span class="text-gray-700 dark:text-gray-300">@slot.StartTime - @slot.EndTime</span>
                                        </div>
                                    }
                                </div>
                            }
                            else
                            {
                                <p class="text-gray-500 dark:text-gray-400 text-sm">No availability added yet.</p>
                            }
                        </div>

                        <!-- Add Services Button -->
                        <div class="bg-primary text-white rounded-lg p-6 text-center">
                            <h3 class="text-lg font-semibold mb-2">Manage Services</h3>
                            <p class="text-sm mb-4">Add new services to your offerings.</p>
                            <button id="add-service-btn" data-craftsman-id="@Model.Id" class="px-6 py-2 bg-white text-primary rounded-lg font-medium hover:bg-gray-100 transition-colors">
                                Add Services
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal Overlay and Add Service Modal -->
    <div class="fixed inset-0 bg-black bg-opacity-60 z-40 backdrop-blur-sm" id="modal-overlay" style="display: none;"></div>
    <div class="fixed inset-0 z-50 flex items-center justify-center p-4" id="add-service-modal" style="display: none;">
        <div class="relative bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-md p-8">
            <button id="close-modal-btn" class="absolute top-4 right-4 text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors">
                <span class="material-icons text-2xl">close</span>
            </button>
            <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-6">Add New Service</h2>
            <form id="addServiceForm">
                <input type="hidden" name="CraftsmanId" value="@Model.Id">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-600 dark:text-gray-400 mb-1" for="service-name">Service Name</label>
                        <input class="w-full bg-background-light dark:bg-background-dark border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 focus:ring-primary focus:border-primary"
                               id="service-name"
                               name="ServiceName"
                               type="text"
                               placeholder="e.g., Pipe Repair">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-600 dark:text-gray-400 mb-1" for="service-category">Category</label>
                        <select class="w-full bg-background-light dark:bg-background-dark border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 focus:ring-primary focus:border-primary"
                                id="service-category"
                                name="CategoryId">
                            <option value="">Select a category</option>
                            @foreach (var c in Model.Categories)
                            {
                                <option value="@c.Id">@c.Name</option>
                            }
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-600 dark:text-gray-400 mb-1" for="service-description">Description</label>
                        <textarea class="w-full bg-background-light dark:bg-background-dark border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 focus:ring-primary focus:border-primary"
                                  id="service-description"
                                  name="Description"
                                  rows="3"
                                  placeholder="Describe the service..."></textarea>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" name="IsPriceFixed" value="true" class="mr-2" id="is-price-fixed">
                        <label for="is-price-fixed" class="text-sm font-medium text-gray-600 dark:text-gray-400">Is Price Fixed</label>
                    </div>
                </div>
                <div class="flex justify-end items-center mt-8 space-x-3">
                    <button type="button" id="cancel-modal-btn" class="px-6 py-2 border rounded-md text-gray-800 dark:text-gray-200 border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">Cancel</button>
                    <button type="submit" id="save-service-btn" class="px-6 py-2 bg-primary text-white rounded-md hover:bg-blue-700 transition-colors">Add</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Request Details Modal -->
    <!-- Request Details Modal -->
    <div id="request-details-modal" class="fixed inset-0 bg-black bg-opacity-60 z-40 backdrop-blur-sm hidden"></div>
    <div id="request-details-modal-content" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div class="relative bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-md p-8">
            <button id="close-request-modal-btn" class="absolute top-4 right-4 text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors">
                <span class="material-icons text-2xl">close</span>
            </button>
            <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-6">Request Details</h2>
            <form id="quote-form" method="post">
                <input type="hidden" id="req-booking-id" name="BookingId" />
                <div class="space-y-4">
                    <div>
                        <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Client:</p>
                        <p class="text-gray-800 dark:text-gray-100" id="modalClient">-</p>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Service:</p>
                        <p class="text-gray-800 dark:text-gray-100" id="modalService">-</p>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Location:</p>
                        <p class="text-gray-800 dark:text-gray-100" id="modalAddress">-</p>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Date & Time:</p>
                        <p class="text-gray-800 dark:text-gray-100" id="modalDateTime">-</p>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Note:</p>
                        <p class="text-gray-800 dark:text-gray-100" id="modalNote">-</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-600 dark:text-gray-400 mb-1" for="quote-input">Add your Quote</label>
                        <input id="quote-input" name="Quote" type="text" class="w-full bg-background-light dark:bg-background-dark border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2" placeholder="e.g., price, notes">
                    </div>
                </div>
                <div class="flex justify-end items-center mt-8 space-x-3">
                    <button type="button" id="refuse-request-btn" class="px-6 py-2 border rounded-md text-red-600 border-red-300 hover:bg-red-50 dark:border-red-600 dark:hover:bg-red-900 transition-colors">Refuse</button>
                    <button type="submit" id="approve-request-btn" class="px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors">Send</button>
                </div>
            </form>
        </div>
    </div>


    <!-- Toast Notification -->
    <div id="toast" style="display:none; position:fixed; top:80px; right:20px; background:#FF9800; color:white; padding:15px 20px; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.15); z-index:9999;"></div>

    <script>
        // Tab functionality
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');

        tabButtons.forEach(button => {
            button.addEventListener('click', function () {
                tabButtons.forEach(btn => {
                    btn.classList.remove('tab-active');
                    btn.classList.add('tab-inactive');
                });
                this.classList.remove('tab-inactive');
                this.classList.add('tab-active');

                tabContents.forEach(content => {
                    content.classList.add('hidden');
                });

                const tabId = this.id.replace('tab-', 'content-');
                const targetContent = document.getElementById(tabId);
                if (targetContent) {
                    targetContent.classList.remove('hidden');
                    void targetContent.offsetWidth;
                }
            });
        });

        // Add Service Modal
        const addServiceBtn = document.getElementById('add-service-btn');
        const modalOverlay = document.getElementById('modal-overlay');
        const addServiceModal = document.getElementById('add-service-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const cancelModalBtn = document.getElementById('cancel-modal-btn');
        const addServiceForm = document.getElementById('addServiceForm');

        function openModal() {
            modalOverlay.style.display = 'block';
            addServiceModal.style.display = 'flex';
        }

        function closeModal() {
            modalOverlay.style.display = 'none';
            addServiceModal.style.display = 'none';
        }

        addServiceBtn.addEventListener('click', openModal);
        closeModalBtn.addEventListener('click', closeModal);
        cancelModalBtn.addEventListener('click', closeModal);
        modalOverlay.addEventListener('click', closeModal);

        // Add Service Form Submission
        if (addServiceForm) {
            addServiceForm.addEventListener('submit', async function (e) {
                e.preventDefault();

                const formData = new FormData(this);
                const dto = Object.fromEntries(formData.entries());
                dto.CraftsmanId = addServiceBtn.dataset.craftsmanId;
                dto.IsPriceFixed = document.getElementById('is-price-fixed').checked;

                try {
                    const response = await fetch('/Craftsman/AddService', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(dto)
                    });

                    const result = await response.json();

                    const toast = document.getElementById("toast");
                    toast.textContent = result.message;
                    toast.style.display = 'block';

                    setTimeout(() => { toast.style.display = 'none'; }, 6000);

                    closeModal();

                            if (result.success && result.newService) {
                                const s = result.newService;
                                const servicesList = document.getElementById("services-list");
                                if (servicesList) {
                                    const serviceCard = document.createElement("div");
                                    serviceCard.className = "service-card flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg";
                                    serviceCard.innerHTML = `
                                        <div>
                                            <p class="font-semibold text-gray-800 dark:text-gray-100">${result.newService.Name || ''}</p>
                                            <p class="text-sm text-gray-500 dark:text-gray-400">${result.newService.ShortDescription || '-'}</p>
                                            <span class="inline-block bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded-full dark:bg-blue-900 dark:text-blue-300 mt-1">${result.newService.Category || '-'}</span>
                                        </div>
                                        <div class="flex items-center gap-3">
                                            <span class="bg-green-100 text-green-800 text-xs font-semibold px-2.5 py-0.5 rounded-full dark:bg-green-900 dark:text-green-300">${result.newService.Status || 'Active'}</span>
                                            <button onclick="deleteService('${result.newService.Id}')" class="text-red-600 hover:text-red-800 transition-colors">
                                                <i class="material-icons">delete</i>
                                            </button>
                                        </div>
                                    `;

                                    servicesList.appendChild(serviceCard);
                                }
                            }

                    document.getElementById('service-name').value = '';
                    document.getElementById('service-category').selectedIndex = 0;
                    document.getElementById('service-description').value = '';
                    document.getElementById('is-price-fixed').checked = false;

                } catch (error) {
                    console.error(error);
                    const toast = document.getElementById("toast");
                    toast.textContent = "Error adding service";
                    toast.style.display = 'block';
                    setTimeout(() => { toast.style.display = 'none'; }, 6000);
                }
            });
        }

        // Request Details Modal
        // عناصر المودال
        const requestDetailsModal = document.getElementById('request-details-modal');
        const requestDetailsModalContent = document.getElementById('request-details-modal-content');
        const closeRequestModalBtn = document.getElementById('close-request-modal-btn');
        const quoteForm = document.getElementById('quote-form');

        // فتح المودال وجلب البيانات بالـ Ajax
        function openRequestDetailsModal(bookingId) {
            requestDetailsModal.classList.remove('hidden');
            requestDetailsModalContent.classList.remove('hidden');
            document.getElementById("req-booking-id").value = bookingId;

            fetch(`/booking/details/${bookingId}`)
                .then(r => r.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById("modalClient").innerText = data.booking.ClientName;
                        document.getElementById("modalService").innerText = data.booking.ServiceName;
                        document.getElementById("modalAddress").innerText = data.booking.FullAddress || "-";
                        document.getElementById("modalDateTime").innerText = `${data.booking.PreferredDate || "-"} ${data.booking.PreferredTime || "-"}`;
                        document.getElementById("modalNote").innerText = data.booking.AdditionalNote || "-";

                    } else {
                        alert(data.message);
                        closeRequestDetailsModal();
                    }
                })
                .catch(err => console.error(err));
        }

        // غلق المودال
        function closeRequestDetailsModal() {
            requestDetailsModal.classList.add('hidden');
            requestDetailsModalContent.classList.add('hidden');
        }

        closeRequestModalBtn.addEventListener('click', closeRequestDetailsModal);
        requestDetailsModal.addEventListener('click', (e) => {
            if (e.target === requestDetailsModal) closeRequestDetailsModal();
        });

        // رفض الطلب
        document.getElementById('refuse-request-btn').addEventListener('click', function () {
            const bookingId = document.getElementById("req-booking-id").value;
            if (confirm('Are you sure you want to refuse this request?')) {
                fetch(`/Booking/RefuseBooking/${bookingId}`, { method: 'POST' })
                    .then(res => res.json())
                    .then(result => {
                        alert(result.message);
                        closeRequestDetailsModal();
                        if (result.success) location.reload();
                    });
            }
        });

        // إرسال العرض (Approve / Send Quote)
        if (quoteForm) {
            quoteForm.addEventListener('submit', function (e) {
                e.preventDefault();
                const bookingId = document.getElementById("req-booking-id").value;
                const quote = document.getElementById("quote-input").value;

                fetch(`/Booking/ApproveBooking/${bookingId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ bookingId: bookingId, quote: quote })
                })
                    .then(res => res.json())
                    .then(result => {
                        alert(result.message);
                        closeRequestDetailsModal();
                        if (result.success) location.reload();
                    });
            });
        }

    </script>

</body>
</html>